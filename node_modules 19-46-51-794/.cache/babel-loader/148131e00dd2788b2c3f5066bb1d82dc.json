{"ast":null,"code":"var _jsxFileName = \"/Users/genta/mapapp-aws1/mapapp-aws1/src/countries/components/CountryUpdate.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useContext, useEffect, useState } from 'react';\nimport { Formik, Field, Form } from 'formik';\nimport { useHistory, NavLink } from 'react-router-dom';\nimport axios from \"axios\";\nimport { API } from '../api';\nimport { AuthContext } from \"../contexts/AuthContext\";\nimport { useParams } from 'react-router';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction ImagePreview({\n  file\n}) {\n  _s();\n\n  const [imageSrc, setImageSrc] = useState(null);\n  useEffect(() => {\n    const reader = new FileReader();\n\n    reader.onloadend = () => {\n      setImageSrc(reader.result);\n    };\n\n    reader.readAsDataURL(file);\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [!imageSrc && \"Loading...\", imageSrc && /*#__PURE__*/_jsxDEV(\"img\", {\n      src: imageSrc,\n      className: \"h-20 w-20 px-3 py-3\",\n      alt: file.name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 22,\n    columnNumber: 9\n  }, this);\n}\n\n_s(ImagePreview, \"OOxWgbNG5e3A0ykrVn+RiF3dlH4=\");\n\n_c = ImagePreview;\nexport function CountryUpdate() {\n  _s2();\n\n  const history = useHistory();\n  const [loading, setLoading] = useState(false);\n  const [loadingCountry, setLoadingCountry] = useState(false);\n  const [file, setFile] = useState(null);\n  const [country, setCountry] = useState(null);\n  const {\n    id\n  } = useParams();\n  const {\n    user: {\n      token\n    }\n  } = useContext(AuthContext);\n  useEffect(() => {\n    if (country && !country.is_owner) {\n      history.push(`/`);\n    }\n\n    return () => null;\n  });\n  useEffect(() => {\n    setLoadingCountry(true);\n\n    function fetchCountry() {\n      axios.get(API.countries.retrieve(id), {\n        headers: {\n          \"Authorization\": `Token ${token}`\n        }\n      }).then(res => {\n        setCountry(res.data);\n      }).finally(() => {\n        setLoadingCountry(false);\n      });\n    }\n\n    fetchCountry();\n    return () => null;\n  }, [id, token]);\n  console.log(country);\n\n  function handleSubmit(values) {\n    console.log(values);\n    setLoading(true);\n    const data = new FormData();\n    data.append('country_image', file);\n    data.append('content', values.content);\n    data.append('country_name', values.country_name);\n    axios.put(API.countries.update(id), data, {\n      headers: {\n        \"Authorization\": `Token ${token}`\n      }\n    }).then(res => {\n      console.log(res.data);\n      history.push(`/`);\n    }).finally(() => {\n      setLoading(false);\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [loading && \"Submitting...\", loadingCountry && \"Fetching Country Details...\", country && /*#__PURE__*/_jsxDEV(Formik, {\n      initialValues: {\n        country_image: country.country_image,\n        country_name: country.country_name,\n        content: country.content\n      },\n      validate: values => {\n        const errors = {};\n\n        if (!values.country_name) {\n          errors.country_name = 'country_nameを入力してください';\n        }\n\n        if (!values.content) {\n          errors.content = 'contentを入力してください';\n        }\n\n        if (!values.country_image) {\n          errors.content = 'contentを入力してください';\n        }\n\n        return errors;\n      },\n      onSubmit: handleSubmit,\n      children: ({\n        errors,\n        touched\n      }) => /*#__PURE__*/_jsxDEV(Form, {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"country_name\",\n          children: \"country_name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(Field, {\n          id: \"country_name\",\n          name: \"country_name\",\n          placeholder: \"Japan\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 25\n        }, this), touched.country_name && errors.country_name && /*#__PURE__*/_jsxDEV(\"div\", {\n          children: errors.country_name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 73\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"content\",\n          children: \"content\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Field, {\n          id: \"content\",\n          name: \"content\",\n          placeholder: \"Cook\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 25\n        }, this), touched.content && errors.content && /*#__PURE__*/_jsxDEV(\"div\", {\n          children: errors.content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 63\n        }, this), /*#__PURE__*/_jsxDEV(Field, {\n          name: \"country_image\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"country_image\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 140,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                onChange: e => setFile(e.target.files[0]),\n                type: \"file\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 141,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 139,\n              columnNumber: 29\n            }, this), file && /*#__PURE__*/_jsxDEV(ImagePreview, {\n              file: file\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          children: \"Submit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 25\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 9\n  }, this);\n}\n\n_s2(CountryUpdate, \"LEY6P0rtXZBZOIIQ1j5fPaPvCE8=\", false, function () {\n  return [useHistory, useParams];\n});\n\n_c2 = CountryUpdate;\nexport default CountryUpdate;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ImagePreview\");\n$RefreshReg$(_c2, \"CountryUpdate\");","map":{"version":3,"sources":["/Users/genta/mapapp-aws1/mapapp-aws1/src/countries/components/CountryUpdate.js"],"names":["useContext","useEffect","useState","Formik","Field","Form","useHistory","NavLink","axios","API","AuthContext","useParams","ImagePreview","file","imageSrc","setImageSrc","reader","FileReader","onloadend","result","readAsDataURL","name","CountryUpdate","history","loading","setLoading","loadingCountry","setLoadingCountry","setFile","country","setCountry","id","user","token","is_owner","push","fetchCountry","get","countries","retrieve","headers","then","res","data","finally","console","log","handleSubmit","values","FormData","append","content","country_name","put","update","country_image","errors","touched","e","target","files"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useState } from 'react';\nimport { Formik, Field, Form } from 'formik';\nimport {useHistory, NavLink} from 'react-router-dom';\nimport axios from \"axios\"\nimport { API } from '../api'\nimport { AuthContext } from \"../contexts/AuthContext\";\nimport { useParams } from 'react-router';\n\n\nfunction ImagePreview({ file }) {\n    const [imageSrc, setImageSrc] = useState(null)\n\n    useEffect(() => {\n        const reader = new FileReader()\n        reader.onloadend = () => {\n            setImageSrc(reader.result)\n        }\n        reader.readAsDataURL(file)\n    })\n\n    return (\n        <div>\n            {!imageSrc && \"Loading...\"}\n            {imageSrc && (\n                <img src={imageSrc} className=\"h-20 w-20 px-3 py-3\" alt={file.name} />\n            )}\n        </div>\n    )\n}\n\n\n\n\nexport function CountryUpdate() {\n    const history = useHistory();\n    const [loading, setLoading] = useState(false)\n    const [loadingCountry, setLoadingCountry] = useState(false)\n    const [file, setFile] = useState(null)\n    const [country, setCountry] = useState(null)\n    const { id } = useParams()\n\n    const { user: { token } } = useContext(AuthContext)\n\n    useEffect(() => {\n        if (country && !country.is_owner) {\n            history.push(`/`)\n        }\n        return () => null\n    })\n    \n    useEffect(() => {\n        setLoadingCountry(true)\n        function fetchCountry() {\n            axios.get(API.countries.retrieve(id),{\n                headers: {\n                    \"Authorization\": `Token ${token}`\n                }\n            })\n                .then(res => {\n                    setCountry(res.data)\n                })\n                .finally(() => {\n                    setLoadingCountry(false)\n                })\n        }\n        fetchCountry()\n        return () => null\n    }, [id, token])\n\n    console.log(country)\n\n    function handleSubmit(values) {\n   \n        \n\n        console.log(values)\n        setLoading(true)\n        const data = new FormData()\n        data.append('country_image', file)\n        data.append('content', values.content)\n        data.append('country_name', values.country_name)\n\n        axios.put(API.countries.update(id), data, {\n            headers: {\n                \"Authorization\": `Token ${token}`,\n               \n            }\n        })\n            .then(res => {\n                console.log(res.data)\n                history.push(`/`)\n            })\n            .finally(() => {\n                setLoading(false)\n            })\n   \n    }\n\n    return (\n        <div>\n            {loading && \"Submitting...\"}\n            {loadingCountry && \"Fetching Country Details...\"}\n            {country && (\n                <Formik\n                    initialValues={{\n                        country_image:country.country_image,\n                        country_name: country.country_name,\n                        content: country.content,\n                       \n                    }}\n                    validate={values => { \n                        const errors = {};\n                        if (!values.country_name) {\n                          errors.country_name = 'country_nameを入力してください' \n                        }\n                        if (!values.content) {\n                            errors.content = 'contentを入力してください' \n                          }\n                        if (!values.country_image) {\n                        errors.content = 'contentを入力してください' \n                        }\n                        return errors;\n                      }}\n                      \n                    onSubmit={handleSubmit}>\n\n                    {({ errors, touched }) => (\n                        <Form>\n                            <label htmlFor=\"country_name\">country_name</label>\n                        <Field id=\"country_name\" name=\"country_name\" placeholder=\"Japan\" />\n                        {touched.country_name && errors.country_name && <div>{errors.country_name}</div>}\n\n                        <label htmlFor=\"content\">content</label>\n                        <Field id=\"content\" name=\"content\" placeholder=\"Cook\" />\n                        {touched.content && errors.content && <div>{errors.content}</div>}\n\n                        <Field name=\"country_image\">\n                        <div >\n                            <label >\n                                <span >country_image</span>\n                                <input\n                                onChange={e => setFile(e.target.files[0])}\n                                type=\"file\"\n                               \n                                />\n                            </label>\n                            {file && (\n                                <ImagePreview file={file} />\n                            )}\n                        </div>\n                        </Field>\n\n\n                        <button type=\"submit\">Submit</button>\n                        </Form>\n                    )}\n\n                </Formik>\n            )}\n        </div>\n    )\n\n}\n\nexport default CountryUpdate"]},"metadata":{},"sourceType":"module"}